<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="geomultistar">
<title>Geographical Queries on Multidimensional Data • geomultistar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Geographical Queries on Multidimensional Data">
<meta property="og:description" content="geomultistar">
<meta property="og:image" content="https://josesamos.github.io/geomultistar/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">geomultistar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/geomultistar.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josesamos/geomultistar/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Geographical Queries on Multidimensional Data</h1>
                        <h4 data-toc-skip class="author">Jose Samos (<a href="mailto:jsamos@ugr.es" class="email">jsamos@ugr.es</a>)</h4>
            
            <h4 data-toc-skip class="date">2020-09-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/geomultistar/blob/HEAD/vignettes/geomultistar.Rmd" class="external-link"><code>vignettes/geomultistar.Rmd</code></a></small>
      <div class="d-none name"><code>geomultistar.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em>multidimensional data model</em> was defined with the aim of
supporting data analysis. In multidimensional systems, data is
structured in facts and dimensions<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Basic concepts of dimensional modelling and star schemas
are presented in &lt;a href="https://CRAN.R-project.org/package=rolap" class="external-link"&gt;`rolap``&lt;/a&gt;
vignettes.&lt;/p&gt;'><sup>1</sup></a>.</p>
<p>The star model is widely accepted, it is recommended for use in
widely distributed end-user tools. In it we have a table for facts and a
table for each dimension. Dimensions provide factual views for easy
querying.</p>
<p>The <em>geographical dimension</em> plays a fundamental role in
multidimensional systems. In a multidimensional schema, there can be
more than one geographic dimension.</p>
<p>These dimensions allow us to associate places of different levels of
detail with the factual data. For example, we can record data at the
city level but later we may be interested in studying them grouped at
the zone or nation level.</p>
<p>It is very interesting to have the possibility of representing the
reports obtained from multidimensional systems, using their geographic
dimensions, on a map, or performing spatial analysis on them. Thus, the
goal of this package is <strong>to enrich multidimensional queries with
geographic data</strong>. In other words, it is not a question of making
spatial queries but of generating a spatial layer with the result of the
multidimensional queries and that this generation is done automatically,
once the configuration of the geographical dimensions has been made.</p>
<p>The rest of this document is structured as follows: An illustrative
example of how the package works is presented. Then, the document ends
with conclusions.</p>
</div>
<div class="section level2">
<h2 id="an-illustrative-example">An illustrative example<a class="anchor" aria-label="anchor" href="#an-illustrative-example"></a>
</h2>
<p>To perform multidimensional queries, the <code>multistar</code> class
was defined in this package. A <code>multistar</code> implements star
schemas: it has a table for each dimension and a table for the facts;
however, it can contain multiple fact tables with some dimensions in
common.</p>
<p>Using the functions defined in the <a href="https://CRAN.R-project.org/package=rolap" class="external-link"><code>rolap</code></a>
or <a href="https://CRAN.R-project.org/package=starschemar" class="external-link"><code>starschemar</code></a>
packages, starting from a flat table implemented by means of a
<code>tibble</code>, we can generate a <code>multistar</code>
object.</p>
<p>If we already have a star schema, <code>geomultistar</code> package
offers functions to generate a <code>multistar</code> object from the
fact and dimension tables in <code>tibble</code> format.</p>
<div class="section level3">
<h3 id="generate-a-multistar-object">Generate a <code>multistar</code> object<a class="anchor" aria-label="anchor" href="#generate-a-multistar-object"></a>
</h3>
<p>In this case, we are going to suppose that we have tables of facts
and dimensions in <code>tibble</code> format, which we have imported
into R. In particular, we have the tables <code>mrs_fact_age</code>,
<code>mrs_fact_cause</code>, <code>mrs_where</code>,
<code>mrs_when</code> and <code>mrs_who</code>: Two fact tables that
share two of the three dimensions.</p>
<div class="section level4">
<h4 id="add-fact-tables">Add fact tables<a class="anchor" aria-label="anchor" href="#add-fact-tables"></a>
</h4>
<p>We create an empty object, to which we will add elements. First we
have to add a fact table, later we will add dimension tables or other
fact tables.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multistar.html">multistar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_facts.html">add_facts</a></span><span class="op">(</span></span>
<span>    fact_name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>    fact_table <span class="op">=</span> <span class="va">mrs_fact_age</span>,</span>
<span>    measures <span class="op">=</span> <span class="st">"n_deaths"</span>,</span>
<span>    nrow_agg <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>For the facts we indicate a name, the table that contains its data
and the names of the columns that contain the measures.</p>
<p>We can indicate an aggregation function associated with each measure.
This parameter should be defined only if some measure is not additive.
In this case it is not necessary.</p>
<p>Finally, we can indicate the name of a field that represents the
number of rows grouped in each query: We can indicate the name of an
existing column in the table for that purpose, or the name that you want
to give to the column to be added if none exists. In this case, the name
of a column in the table is assigned.</p>
<p>Next we add another table of facts with characteristics similar to
the previous one.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="va">ms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_facts.html">add_facts</a></span><span class="op">(</span></span>
<span>    fact_name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>    fact_table <span class="op">=</span> <span class="va">mrs_fact_cause</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pneumonia_and_influenza_deaths"</span>, <span class="st">"other_deaths"</span><span class="op">)</span>,</span>
<span>    nrow_agg <span class="op">=</span> <span class="st">"nrow_agg"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>In this case, the column that contains the number of grouped rows
precisely has the name that is assigned by default.</p>
</div>
<div class="section level4">
<h4 id="add-dimension-tables">Add dimension tables<a class="anchor" aria-label="anchor" href="#add-dimension-tables"></a>
</h4>
<p>Once we have at least one fact table, we can add dimension
tables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="va">ms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_dimension.html">add_dimension</a></span><span class="op">(</span></span>
<span>    dimension_name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    dimension_table <span class="op">=</span> <span class="va">mrs_where</span>,</span>
<span>    dimension_key <span class="op">=</span> <span class="st">"where_pk"</span>,</span>
<span>    fact_name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>    fact_key <span class="op">=</span> <span class="st">"where_fk"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>For each dimension we define its name, the table that contains the
data, the name of the primary key and, for the table of facts with which
we are going to relate it, its name and the name of the corresponding
foreign key.</p>
<p>To establish the relationship successfully, it is verified that there
is referential integrity between the tables using the indicated columns.
The columns corresponding to the primary and foreign keys are renamed
and are no longer available for queries. If you want to keep the field
in the dimension, it can be indicated by a parameter, as is shown below
by parameter <code>key_as_data</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="va">ms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_dimension.html">add_dimension</a></span><span class="op">(</span></span>
<span>    dimension_name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>    dimension_table <span class="op">=</span> <span class="va">mrs_when</span>,</span>
<span>    dimension_key <span class="op">=</span> <span class="st">"when_pk"</span>,</span>
<span>    fact_name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>    fact_key <span class="op">=</span> <span class="st">"when_fk"</span>,</span>
<span>    key_as_data <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_dimension.html">add_dimension</a></span><span class="op">(</span></span>
<span>    dimension_name <span class="op">=</span> <span class="st">"who"</span>,</span>
<span>    dimension_table <span class="op">=</span> <span class="va">mrs_who</span>,</span>
<span>    dimension_key <span class="op">=</span> <span class="st">"who_pk"</span>,</span>
<span>    fact_name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>    fact_key <span class="op">=</span> <span class="st">"who_fk"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>If a dimension is related to more than one fact table, when it is
added, its relationship to only one can be defined. Later, additional
relationships can be defined, as we will see next.</p>
</div>
<div class="section level4">
<h4 id="relate-dimensions">Relate dimensions<a class="anchor" aria-label="anchor" href="#relate-dimensions"></a>
</h4>
<p>Once a dimension is included in the <code>multistar</code> object, we
can relate it to other fact tables.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="va">ms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_dimension.html">relate_dimension</a></span><span class="op">(</span>dimension_name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>                   fact_name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>                   fact_key <span class="op">=</span> <span class="st">"where_fk"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_dimension.html">relate_dimension</a></span><span class="op">(</span>dimension_name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>                   fact_name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>                   fact_key <span class="op">=</span> <span class="st">"when_fk"</span><span class="op">)</span></span></code></pre></div>
<p>In this case, to specify the dimension we only have to indicate its
name.</p>
</div>
<div class="section level4">
<h4 id="additional-operations-on-the-multistar-object">Additional operations on the <code>multistar</code> object<a class="anchor" aria-label="anchor" href="#additional-operations-on-the-multistar-object"></a>
</h4>
<p>Through the previous operations, we generate a <code>multistar</code>
object to which we can apply the operations defined for this class. At
this moment we can export it as a flat table, using
<code>multistar_as_flat_table</code>, or define multidimensional
queries, as we will later use <code>dimensional_query</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="define-geographic-dimensions-and-attributes">Define geographic dimensions and attributes<a class="anchor" aria-label="anchor" href="#define-geographic-dimensions-and-attributes"></a>
</h3>
<p>To define the dimensions and geographic attributes of a
<code>multistar</code> object, we must define a
<code>geomultistar</code> specialization from it, which allows to store
this information.</p>
<p>We create a <code>geomultistar</code> object from a
<code>multistar</code> one defining the names of the dimensions that
contain geographic information. In the example only one dimension.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gms</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geomultistar.html">geomultistar</a></span><span class="op">(</span><span class="va">ms</span>, geodimension <span class="op">=</span> <span class="st">"where"</span><span class="op">)</span></span></code></pre></div>
<p>For each attribute of a geographic dimension that we want to use in
queries, we can define a vector geographic data layer with which a
relationship can be established using one or more attributes of the
dimension.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gms</span> <span class="op">&lt;-</span> <span class="va">gms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    attribute <span class="op">=</span> <span class="st">"city"</span>,</span>
<span>    from_layer <span class="op">=</span> <span class="va">usa_cities</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"city"</span> <span class="op">=</span> <span class="st">"city"</span>, <span class="st">"state"</span> <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>For the <code>city</code> attribute, a relationship is defined with a
vector geographic data layer in <code>sf</code> format
(<code>usa_cities</code>), using the <code>city</code> and
<code>state</code> attributes<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It is appropriate to use &lt;code&gt;city&lt;/code&gt; and
&lt;code&gt;state&lt;/code&gt; to establish the relationship because the granularity
of the data is &lt;code&gt;city&lt;/code&gt; and there can be repeated city names in
different states.&lt;/p&gt;"><sup>2</sup></a> that have the same name in the layer.</p>
<p>Sometimes there may be problems establishing the correspondence
between the geographic attributes and the vector layer: Instances may
remain unrelated. To detect these situations, we can query the rows that
do not have associated geometry using the following function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empty_city</span> <span class="op">&lt;-</span> <span class="va">gms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_empty_geoinstances.html">get_empty_geoinstances</a></span><span class="op">(</span>attribute <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span></span></code></pre></div>
<p>The result obtained is shown below.</p>
<table style="width:65%;" class="table">
<colgroup>
<col width="13%">
<col width="13%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="center">city</th>
<th align="center">state</th>
<th align="center">geometry</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Unknown</td>
<td align="center">Unknown</td>
<td align="center">GEOMETRYCOLLECTION EMPTY</td>
</tr></tbody>
</table>
<p>In this case, for the unknown cities, their location has not been
determined. There may be several because other geographic data of less
granularity may be known.</p>
<p>In the same way, the relationship for <code>county</code> with the
corresponding layer (<code>usa_counties</code>) is defined.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gms</span> <span class="op">&lt;-</span> <span class="va">gms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    attribute <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>    from_layer <span class="op">=</span> <span class="va">usa_counties</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county"</span> <span class="op">=</span> <span class="st">"county"</span>, <span class="st">"state"</span> <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>  </span></code></pre></div>
<p>We check if they have all been related.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empty_county</span> <span class="op">&lt;-</span> <span class="va">gms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_empty_geoinstances.html">get_empty_geoinstances</a></span><span class="op">(</span>attribute <span class="op">=</span> <span class="st">"county"</span><span class="op">)</span></span></code></pre></div>
<p>And the result obtained is shown below.</p>
<table style="width:65%;" class="table">
<colgroup>
<col width="13%">
<col width="13%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="center">county</th>
<th align="center">state</th>
<th align="center">geometry</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Unknown</td>
<td align="center">Unknown</td>
<td align="center">GEOMETRYCOLLECTION EMPTY</td>
</tr></tbody>
</table>
<p>It also happens for the same instances. In this case we can see that
the associated geometry is of a different type.</p>
<p>In the case of <code>state</code> the definition is carried out by
associating the code to the corresponding one in the layer
(<code>usa_states</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gms</span> <span class="op">&lt;-</span> <span class="va">gms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    attribute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span>,</span>
<span>    from_layer <span class="op">=</span> <span class="va">usa_states</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>Additionally, for an attribute we can generate its layer from the one
associated with another related attribute of the dimension. This is what
has been done below for <code>division</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gms</span> <span class="op">&lt;-</span> <span class="va">gms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    attribute <span class="op">=</span> <span class="st">"division"</span>,</span>
<span>    from_attribute <span class="op">=</span> <span class="st">"state"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>In this case, the vector layer is generated from the data available
in the layer under consideration. Sometimes this is precisely what is
desired. If not, look for a vector layer at that level of detail.</p>
<p>If no attribute name is indicated, this operation is applied to the
rest of the attributes of the dimension that do not have an associated
vector layer by any of the methods presented, as shown below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gms</span> <span class="op">&lt;-</span> <span class="va">gms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span>from_attribute <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></code></pre></div>
<p>With this we have all the attributes of the dimension with an
associated layer, defined at its level of granularity<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If we are not going to use them in queries it is not
necessary that they have the associated layer.&lt;/p&gt;"><sup>3</sup></a>. On the other hand, we
can change the layer of any attribute at any time, independently of the
rest.</p>
</div>
<div class="section level3">
<h3 id="define-multidimensional-queries">Define multidimensional queries<a class="anchor" aria-label="anchor" href="#define-multidimensional-queries"></a>
</h3>
<p>Multidimensional queries are defined from a <code>multistar</code>
object. Since we are working with <code>geomultistar</code>, a
specialization of <code>multistar</code>, we can use this object to
define the query.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdqr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimensional_query.html">dimensional_query</a></span><span class="op">(</span><span class="va">gms</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"division_name"</span>, <span class="st">"region_name"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>              measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_deaths"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pneumonia_and_influenza_deaths"</span>, <span class="st">"other_deaths"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_dimension.html">filter_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>, <span class="va">week</span> <span class="op">&lt;=</span> <span class="st">"03"</span><span class="op">)</span></span></code></pre></div>
<p>The definition functions of this type of queries is based on the
selection of facts and dimensions, and the filter of dimensions.</p>
<p>If we use the function <code><a href="../reference/run_query.html">run_query()</a></code>, a multidimensional
query is executed, as shown below.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft</span> <span class="op">&lt;-</span> <span class="va">gdqr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_query.html">run_query</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/multistar_as_flat_table.html">multistar_as_flat_table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The result of this type of query is a <code>multistar</code> object,
which we can transform into a flat table to display it more easily, as
we do below for the first rows.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="4%">
<col width="13%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="27%">
<col width="15%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">year</th>
<th align="center">week</th>
<th align="center">division_name</th>
<th align="center">region_name</th>
<th align="center">n_deaths</th>
<th align="center">count</th>
<th align="center">mrs_cause_pneumonia_and_influenza_deaths</th>
<th align="center">mrs_cause_other_deaths</th>
<th align="center">mrs_cause_nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">East North Central</td>
<td align="center">Midwest</td>
<td align="center">2258</td>
<td align="center">75</td>
<td align="center">113</td>
<td align="center">2145</td>
<td align="center">16</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">East South Central</td>
<td align="center">South</td>
<td align="center">526</td>
<td align="center">35</td>
<td align="center">31</td>
<td align="center">495</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">Middle Atlantic</td>
<td align="center">Northeast</td>
<td align="center">3452</td>
<td align="center">86</td>
<td align="center">173</td>
<td align="center">3279</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">Mountain</td>
<td align="center">West</td>
<td align="center">414</td>
<td align="center">35</td>
<td align="center">34</td>
<td align="center">380</td>
<td align="center">8</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">New England</td>
<td align="center">Northeast</td>
<td align="center">785</td>
<td align="center">57</td>
<td align="center">56</td>
<td align="center">729</td>
<td align="center">14</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">Pacific</td>
<td align="center">West</td>
<td align="center">1567</td>
<td align="center">67</td>
<td align="center">56</td>
<td align="center">1511</td>
<td align="center">14</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">South Atlantic</td>
<td align="center">South</td>
<td align="center">1271</td>
<td align="center">59</td>
<td align="center">58</td>
<td align="center">1213</td>
<td align="center">12</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">West North Central</td>
<td align="center">Midwest</td>
<td align="center">936</td>
<td align="center">46</td>
<td align="center">47</td>
<td align="center">889</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">West South Central</td>
<td align="center">South</td>
<td align="center">1243</td>
<td align="center">65</td>
<td align="center">66</td>
<td align="center">1177</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">02</td>
<td align="center">East North Central</td>
<td align="center">Midwest</td>
<td align="center">2289</td>
<td align="center">76</td>
<td align="center">115</td>
<td align="center">2174</td>
<td align="center">16</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">02</td>
<td align="center">East South Central</td>
<td align="center">South</td>
<td align="center">575</td>
<td align="center">33</td>
<td align="center">36</td>
<td align="center">539</td>
<td align="center">7</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">02</td>
<td align="center">Middle Atlantic</td>
<td align="center">Northeast</td>
<td align="center">3426</td>
<td align="center">90</td>
<td align="center">157</td>
<td align="center">3269</td>
<td align="center">20</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="run-queries-adding-geographic-information">Run queries adding geographic information<a class="anchor" aria-label="anchor" href="#run-queries-adding-geographic-information"></a>
</h3>
<p>If instead of executing the standard query, we execute
<code><a href="../reference/run_geoquery.html">run_geoquery()</a></code> function, we automatically obtain a vector
geographic data layer at the finest possible level of detail, depending
on the definition of the query.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vl_sf</span> <span class="op">&lt;-</span> <span class="va">gdqr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_geoquery.html">run_geoquery</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The first rows of the result can be seen below in table form.</p>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="11%">
<col width="7%">
<col width="5%">
<col width="4%">
<col width="22%">
<col width="13%">
<col width="11%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="center">year</th>
<th align="center">week</th>
<th align="center">division_name</th>
<th align="center">region_name</th>
<th align="center">n_deaths</th>
<th align="center">count</th>
<th align="center">mrs_cause_pneumonia_and_influenza_deaths</th>
<th align="center">mrs_cause_other_deaths</th>
<th align="center">mrs_cause_nrow_agg</th>
<th align="center">geometry</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">East North Central</td>
<td align="center">Midwest</td>
<td align="center">2258</td>
<td align="center">75</td>
<td align="center">113</td>
<td align="center">2145</td>
<td align="center">16</td>
<td align="center">MULTIPOLYGON (((-84.65 45.8…</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">East South Central</td>
<td align="center">South</td>
<td align="center">526</td>
<td align="center">35</td>
<td align="center">31</td>
<td align="center">495</td>
<td align="center">7</td>
<td align="center">MULTIPOLYGON (((-88.4 30.37…</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">Middle Atlantic</td>
<td align="center">Northeast</td>
<td align="center">3452</td>
<td align="center">86</td>
<td align="center">173</td>
<td align="center">3279</td>
<td align="center">20</td>
<td align="center">MULTIPOLYGON (((-72.03 41.2…</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">Mountain</td>
<td align="center">West</td>
<td align="center">414</td>
<td align="center">35</td>
<td align="center">34</td>
<td align="center">380</td>
<td align="center">8</td>
<td align="center">MULTIPOLYGON (((-109.1 41, …</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">New England</td>
<td align="center">Northeast</td>
<td align="center">785</td>
<td align="center">57</td>
<td align="center">56</td>
<td align="center">729</td>
<td align="center">14</td>
<td align="center">MULTIPOLYGON (((-71.59 41.1…</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">Pacific</td>
<td align="center">West</td>
<td align="center">1567</td>
<td align="center">67</td>
<td align="center">56</td>
<td align="center">1511</td>
<td align="center">14</td>
<td align="center">MULTIPOLYGON (((-156.1 19.7…</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">South Atlantic</td>
<td align="center">South</td>
<td align="center">1271</td>
<td align="center">59</td>
<td align="center">58</td>
<td align="center">1213</td>
<td align="center">12</td>
<td align="center">MULTIPOLYGON (((-81.81 24.5…</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">West North Central</td>
<td align="center">Midwest</td>
<td align="center">936</td>
<td align="center">46</td>
<td align="center">47</td>
<td align="center">889</td>
<td align="center">10</td>
<td align="center">POLYGON ((-102 36.99, -94.6…</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">01</td>
<td align="center">West South Central</td>
<td align="center">South</td>
<td align="center">1243</td>
<td align="center">65</td>
<td align="center">66</td>
<td align="center">1177</td>
<td align="center">13</td>
<td align="center">POLYGON ((-106.6 31.87, -10…</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">02</td>
<td align="center">East North Central</td>
<td align="center">Midwest</td>
<td align="center">2289</td>
<td align="center">76</td>
<td align="center">115</td>
<td align="center">2174</td>
<td align="center">16</td>
<td align="center">MULTIPOLYGON (((-84.65 45.8…</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">02</td>
<td align="center">East South Central</td>
<td align="center">South</td>
<td align="center">575</td>
<td align="center">33</td>
<td align="center">36</td>
<td align="center">539</td>
<td align="center">7</td>
<td align="center">MULTIPOLYGON (((-88.4 30.37…</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">02</td>
<td align="center">Middle Atlantic</td>
<td align="center">Northeast</td>
<td align="center">3426</td>
<td align="center">90</td>
<td align="center">157</td>
<td align="center">3269</td>
<td align="center">20</td>
<td align="center">MULTIPOLYGON (((-72.03 41.2…</td>
</tr>
</tbody>
</table>
<p>The result is a vector geographic data layer that we can save,
perform spatial analysis or queries on it, or we can see it as a map,
using the functions associated with the <code>sf</code> class.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">vl_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sf"         "tbl_df"     "tbl"        "data.frame"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vl_sf</span><span class="op">[</span>,<span class="st">"n_deaths"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="geomultistar_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Although we have indicated in the query the attributes
<code>division_name</code> and <code>region_name</code>, as can be seen
in the figure, the result obtained is at the finest granularity level,
in this case at the <code>division_name</code> level.</p>
<p>Only the parts of the divisions made up of states where there is
recorded data are shown. If we wanted to show the full extent of each
division, we should have explicitly associated a layer at that
level.</p>
</div>
<div class="section level3">
<h3 id="get-wide-tables">Get wide tables<a class="anchor" aria-label="anchor" href="#get-wide-tables"></a>
</h3>
<p>In geographic layers, geographic objects usually are not repeated.
The tables are wide: for each object the rest of the attributes are
defined as columns. By means of the parameter <code>wider</code> we can
indicate that we want a result of this type.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vl_sf_w</span> <span class="op">&lt;-</span> <span class="va">gdqr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_geoquery.html">run_geoquery</a></span><span class="op">(</span>wider <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The first rows of the result can be seen below in table form.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="1%">
<col width="1%">
<col width="4%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="center">fid</th>
<th align="center">year</th>
<th align="center">division_name</th>
<th align="center">region_name</th>
<th align="center">n_deaths_01</th>
<th align="center">n_deaths_02</th>
<th align="center">n_deaths_03</th>
<th align="center">count_01</th>
<th align="center">count_02</th>
<th align="center">count_03</th>
<th align="center">mrs_cause_pneumonia_and_influenza_deaths_01</th>
<th align="center">mrs_cause_pneumonia_and_influenza_deaths_02</th>
<th align="center">mrs_cause_pneumonia_and_influenza_deaths_03</th>
<th align="center">mrs_cause_other_deaths_01</th>
<th align="center">mrs_cause_other_deaths_02</th>
<th align="center">mrs_cause_other_deaths_03</th>
<th align="center">mrs_cause_nrow_agg_01</th>
<th align="center">mrs_cause_nrow_agg_02</th>
<th align="center">mrs_cause_nrow_agg_03</th>
<th align="center">geometry</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962</td>
<td align="center">East North Central</td>
<td align="center">Midwest</td>
<td align="center">2258</td>
<td align="center">2289</td>
<td align="center">2314</td>
<td align="center">75</td>
<td align="center">76</td>
<td align="center">75</td>
<td align="center">113</td>
<td align="center">115</td>
<td align="center">125</td>
<td align="center">2145</td>
<td align="center">2174</td>
<td align="center">2189</td>
<td align="center">16</td>
<td align="center">16</td>
<td align="center">16</td>
<td align="center">MULTIPOLYGON (((-84.65 45.8…</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962</td>
<td align="center">East South Central</td>
<td align="center">South</td>
<td align="center">526</td>
<td align="center">575</td>
<td align="center">650</td>
<td align="center">35</td>
<td align="center">33</td>
<td align="center">32</td>
<td align="center">31</td>
<td align="center">36</td>
<td align="center">44</td>
<td align="center">495</td>
<td align="center">539</td>
<td align="center">606</td>
<td align="center">7</td>
<td align="center">7</td>
<td align="center">7</td>
<td align="center">MULTIPOLYGON (((-88.4 30.37…</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962</td>
<td align="center">Middle Atlantic</td>
<td align="center">Northeast</td>
<td align="center">3452</td>
<td align="center">3426</td>
<td align="center">3413</td>
<td align="center">86</td>
<td align="center">90</td>
<td align="center">91</td>
<td align="center">173</td>
<td align="center">157</td>
<td align="center">160</td>
<td align="center">3279</td>
<td align="center">3269</td>
<td align="center">3253</td>
<td align="center">20</td>
<td align="center">20</td>
<td align="center">20</td>
<td align="center">MULTIPOLYGON (((-72.03 41.2…</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962</td>
<td align="center">Mountain</td>
<td align="center">West</td>
<td align="center">414</td>
<td align="center">411</td>
<td align="center">472</td>
<td align="center">35</td>
<td align="center">34</td>
<td align="center">35</td>
<td align="center">34</td>
<td align="center">21</td>
<td align="center">29</td>
<td align="center">380</td>
<td align="center">390</td>
<td align="center">443</td>
<td align="center">8</td>
<td align="center">8</td>
<td align="center">8</td>
<td align="center">MULTIPOLYGON (((-109.1 41, …</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962</td>
<td align="center">New England</td>
<td align="center">Northeast</td>
<td align="center">785</td>
<td align="center">785</td>
<td align="center">726</td>
<td align="center">57</td>
<td align="center">61</td>
<td align="center">57</td>
<td align="center">56</td>
<td align="center">52</td>
<td align="center">48</td>
<td align="center">729</td>
<td align="center">733</td>
<td align="center">678</td>
<td align="center">14</td>
<td align="center">14</td>
<td align="center">14</td>
<td align="center">MULTIPOLYGON (((-71.59 41.1…</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962</td>
<td align="center">Pacific</td>
<td align="center">West</td>
<td align="center">1567</td>
<td align="center">1823</td>
<td align="center">1637</td>
<td align="center">67</td>
<td align="center">67</td>
<td align="center">66</td>
<td align="center">56</td>
<td align="center">70</td>
<td align="center">76</td>
<td align="center">1511</td>
<td align="center">1753</td>
<td align="center">1561</td>
<td align="center">14</td>
<td align="center">14</td>
<td align="center">14</td>
<td align="center">MULTIPOLYGON (((-156.1 19.7…</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">1962</td>
<td align="center">South Atlantic</td>
<td align="center">South</td>
<td align="center">1271</td>
<td align="center">1179</td>
<td align="center">1319</td>
<td align="center">59</td>
<td align="center">58</td>
<td align="center">57</td>
<td align="center">58</td>
<td align="center">54</td>
<td align="center">62</td>
<td align="center">1213</td>
<td align="center">1125</td>
<td align="center">1257</td>
<td align="center">12</td>
<td align="center">12</td>
<td align="center">12</td>
<td align="center">MULTIPOLYGON (((-81.81 24.5…</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">1962</td>
<td align="center">West North Central</td>
<td align="center">Midwest</td>
<td align="center">936</td>
<td align="center">1040</td>
<td align="center">936</td>
<td align="center">46</td>
<td align="center">47</td>
<td align="center">47</td>
<td align="center">47</td>
<td align="center">74</td>
<td align="center">55</td>
<td align="center">889</td>
<td align="center">966</td>
<td align="center">881</td>
<td align="center">10</td>
<td align="center">10</td>
<td align="center">10</td>
<td align="center">POLYGON ((-102 36.99, -94.6…</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">1962</td>
<td align="center">West South Central</td>
<td align="center">South</td>
<td align="center">1243</td>
<td align="center">1096</td>
<td align="center">1297</td>
<td align="center">65</td>
<td align="center">63</td>
<td align="center">59</td>
<td align="center">66</td>
<td align="center">67</td>
<td align="center">85</td>
<td align="center">1177</td>
<td align="center">1029</td>
<td align="center">1212</td>
<td align="center">13</td>
<td align="center">13</td>
<td align="center">13</td>
<td align="center">POLYGON ((-106.6 31.87, -10…</td>
</tr>
</tbody>
</table>
<p>We can see that the attributes that are multivalued for each
geographic object have been eliminated from the result table, and new
measurement columns have been generated: one for each combination of
values of these attributes with the original measurements.</p>
<p>The meaning of the name of the columns of the measurements is part of
the result obtained, also in table format, as can be seen below.</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="44%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="center">id_variable</th>
<th align="center">measure</th>
<th align="center">week</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">n_deaths_01</td>
<td align="center">n_deaths</td>
<td align="center">01</td>
</tr>
<tr class="even">
<td align="center">n_deaths_02</td>
<td align="center">n_deaths</td>
<td align="center">02</td>
</tr>
<tr class="odd">
<td align="center">n_deaths_03</td>
<td align="center">n_deaths</td>
<td align="center">03</td>
</tr>
<tr class="even">
<td align="center">count_01</td>
<td align="center">count</td>
<td align="center">01</td>
</tr>
<tr class="odd">
<td align="center">count_02</td>
<td align="center">count</td>
<td align="center">02</td>
</tr>
<tr class="even">
<td align="center">count_03</td>
<td align="center">count</td>
<td align="center">03</td>
</tr>
<tr class="odd">
<td align="center">mrs_cause_pneumonia_and_influenza_deaths_01</td>
<td align="center">mrs_cause_pneumonia_and_influenza_deaths</td>
<td align="center">01</td>
</tr>
<tr class="even">
<td align="center">mrs_cause_pneumonia_and_influenza_deaths_02</td>
<td align="center">mrs_cause_pneumonia_and_influenza_deaths</td>
<td align="center">02</td>
</tr>
<tr class="odd">
<td align="center">mrs_cause_pneumonia_and_influenza_deaths_03</td>
<td align="center">mrs_cause_pneumonia_and_influenza_deaths</td>
<td align="center">03</td>
</tr>
<tr class="even">
<td align="center">mrs_cause_other_deaths_01</td>
<td align="center">mrs_cause_other_deaths</td>
<td align="center">01</td>
</tr>
<tr class="odd">
<td align="center">mrs_cause_other_deaths_02</td>
<td align="center">mrs_cause_other_deaths</td>
<td align="center">02</td>
</tr>
<tr class="even">
<td align="center">mrs_cause_other_deaths_03</td>
<td align="center">mrs_cause_other_deaths</td>
<td align="center">03</td>
</tr>
</tbody>
</table>
<p>In this case there was only one variable with a multiplicity greater
than one. If there were more variables in this situation, they would be
added to this table in the same way.</p>
<p>This data dictionary table and layer structure can be saved in
<em>GeoPackage</em> format using the <code><a href="../reference/save_as_geopackage.html">save_as_geopackage()</a></code>
function.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_as_geopackage.html">save_as_geopackage</a></span><span class="op">(</span><span class="va">vl_sf_w</span>, <span class="st">"division"</span><span class="op">)</span></span></code></pre></div>
<p>The <em>GeoPackages</em> thus obtained can be used directly, for
example in <em>QGIS</em>.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>To generate the multidimensional structure on which to define
queries, we can use the functions of the <a href="https://CRAN.R-project.org/package=rolap" class="external-link"><code>rolap</code></a>
package or, if we already have the multidimensional design implemented,
the import functions included in this package.</p>
<p>The <code>geomultistar</code> package allows generating vector
geographic data layers in <code>sf</code> format as a result of
multidimensional queries. To do this, all we need is to associate vector
geographic data layers with some of the attributes of the geographic
dimensions, so that the layers associated with the rest of the
attributes can be obtained automatically. Queries do not present any
additional difficulties due to the fact of returning geographic
data.</p>
<p>The data obtained can be processed with the <code>sf</code> package
to define spatial queries or analysis, be presented in maps or saved as
a file to be used by a GIS (<em>Geographical Information System</em>)
tool.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
